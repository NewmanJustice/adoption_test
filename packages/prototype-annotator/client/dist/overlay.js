(function(){"use strict";var A,x,le,D,se,ce,_e,de,K,V,Q,Y={},pe=[],Oe=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,F=Array.isArray;function H(e,t){for(var n in t)e[n]=t[n];return e}function Z(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function De(e,t,n){var r,a,o,s={};for(o in t)o=="key"?r=t[o]:o=="ref"?a=t[o]:s[o]=t[o];if(arguments.length>2&&(s.children=arguments.length>3?A.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(o in e.defaultProps)s[o]===void 0&&(s[o]=e.defaultProps[o]);return R(e,s,r,a,null)}function R(e,t,n,r,a){var o={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:a??++le,__i:-1,__u:0};return a==null&&x.vnode!=null&&x.vnode(o),o}function P(e){return e.children}function j(e,t){this.props=e,this.context=t}function U(e,t){if(t==null)return e.__?U(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?U(e):null}function ue(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return ue(e)}}function fe(e){(!e.__d&&(e.__d=!0)&&D.push(e)&&!B.__r++||se!=x.debounceRendering)&&((se=x.debounceRendering)||ce)(B)}function B(){for(var e,t,n,r,a,o,s,l=1;D.length;)D.length>l&&D.sort(_e),e=D.shift(),l=D.length,e.__d&&(n=void 0,r=void 0,a=(r=(t=e).__v).__e,o=[],s=[],t.__P&&((n=H({},r)).__v=r.__v+1,x.vnode&&x.vnode(n),ee(t.__P,n,r,t.__n,t.__P.namespaceURI,32&r.__u?[a]:null,o,a??U(r),!!(32&r.__u),s),n.__v=r.__v,n.__.__k[n.__i]=n,ge(o,n,s),r.__e=r.__=null,n.__e!=a&&ue(n)));B.__r=0}function he(e,t,n,r,a,o,s,l,u,c,f){var i,h,p,d,m,v,b,g=r&&r.__k||pe,C=t.length;for(u=ze(n,t,g,u,C),i=0;i<C;i++)(p=n.__k[i])!=null&&(h=p.__i==-1?Y:g[p.__i]||Y,p.__i=i,v=ee(e,p,h,a,o,s,l,u,c,f),d=p.__e,p.ref&&h.ref!=p.ref&&(h.ref&&ne(h.ref,null,p),f.push(p.ref,p.__c||d,p)),m==null&&d!=null&&(m=d),(b=!!(4&p.__u))||h.__k===p.__k?u=me(p,u,e,b):typeof p.type=="function"&&v!==void 0?u=v:d&&(u=d.nextSibling),p.__u&=-7);return n.__e=m,u}function ze(e,t,n,r,a){var o,s,l,u,c,f=n.length,i=f,h=0;for(e.__k=new Array(a),o=0;o<a;o++)(s=t[o])!=null&&typeof s!="boolean"&&typeof s!="function"?(typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?s=e.__k[o]=R(null,s,null,null,null):F(s)?s=e.__k[o]=R(P,{children:s},null,null,null):s.constructor===void 0&&s.__b>0?s=e.__k[o]=R(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):e.__k[o]=s,u=o+h,s.__=e,s.__b=e.__b+1,l=null,(c=s.__i=Ue(s,n,u,i))!=-1&&(i--,(l=n[c])&&(l.__u|=2)),l==null||l.__v==null?(c==-1&&(a>f?h--:a<f&&h++),typeof s.type!="function"&&(s.__u|=4)):c!=u&&(c==u-1?h--:c==u+1?h++:(c>u?h--:h++,s.__u|=4))):e.__k[o]=null;if(i)for(o=0;o<f;o++)(l=n[o])!=null&&(2&l.__u)==0&&(l.__e==r&&(r=U(l)),xe(l,l));return r}function me(e,t,n,r){var a,o;if(typeof e.type=="function"){for(a=e.__k,o=0;a&&o<a.length;o++)a[o]&&(a[o].__=e,t=me(a[o],t,n,r));return t}e.__e!=t&&(r&&(t&&e.type&&!t.parentNode&&(t=U(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Ue(e,t,n,r){var a,o,s,l=e.key,u=e.type,c=t[n],f=c!=null&&(2&c.__u)==0;if(c===null&&l==null||f&&l==c.key&&u==c.type)return n;if(r>(f?1:0)){for(a=n-1,o=n+1;a>=0||o<t.length;)if((c=t[s=a>=0?a--:o++])!=null&&(2&c.__u)==0&&l==c.key&&u==c.type)return s}return-1}function be(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||Oe.test(t)?n:n+"px"}function W(e,t,n,r,a){var o,s;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||be(e.style,t,"");if(n)for(t in n)r&&n[t]==r[t]||be(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")o=t!=(t=t.replace(de,"$1")),s=t.toLowerCase(),t=s in e||t=="onFocusOut"||t=="onFocusIn"?s.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?r?n.u=r.u:(n.u=K,e.addEventListener(t,o?Q:V,o)):e.removeEventListener(t,o?Q:V,o);else{if(a=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function ve(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=K++;else if(t.t<n.u)return;return n(x.event?x.event(t):t)}}}function ee(e,t,n,r,a,o,s,l,u,c){var f,i,h,p,d,m,v,b,g,C,w,O,z,X,y,$,J,M=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(u=!!(32&n.__u),o=[l=t.__e=n.__e]),(f=x.__b)&&f(t);e:if(typeof M=="function")try{if(b=t.props,g="prototype"in M&&M.prototype.render,C=(f=M.contextType)&&r[f.__c],w=f?C?C.props.value:f.__:r,n.__c?v=(i=t.__c=n.__c).__=i.__E:(g?t.__c=i=new M(b,w):(t.__c=i=new j(b,w),i.constructor=M,i.render=Ie),C&&C.sub(i),i.state||(i.state={}),i.__n=r,h=i.__d=!0,i.__h=[],i._sb=[]),g&&i.__s==null&&(i.__s=i.state),g&&M.getDerivedStateFromProps!=null&&(i.__s==i.state&&(i.__s=H({},i.__s)),H(i.__s,M.getDerivedStateFromProps(b,i.__s))),p=i.props,d=i.state,i.__v=t,h)g&&M.getDerivedStateFromProps==null&&i.componentWillMount!=null&&i.componentWillMount(),g&&i.componentDidMount!=null&&i.__h.push(i.componentDidMount);else{if(g&&M.getDerivedStateFromProps==null&&b!==p&&i.componentWillReceiveProps!=null&&i.componentWillReceiveProps(b,w),t.__v==n.__v||!i.__e&&i.shouldComponentUpdate!=null&&i.shouldComponentUpdate(b,i.__s,w)===!1){for(t.__v!=n.__v&&(i.props=b,i.state=i.__s,i.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(L){L&&(L.__=t)}),O=0;O<i._sb.length;O++)i.__h.push(i._sb[O]);i._sb=[],i.__h.length&&s.push(i);break e}i.componentWillUpdate!=null&&i.componentWillUpdate(b,i.__s,w),g&&i.componentDidUpdate!=null&&i.__h.push(function(){i.componentDidUpdate(p,d,m)})}if(i.context=w,i.props=b,i.__P=e,i.__e=!1,z=x.__r,X=0,g){for(i.state=i.__s,i.__d=!1,z&&z(t),f=i.render(i.props,i.state,i.context),y=0;y<i._sb.length;y++)i.__h.push(i._sb[y]);i._sb=[]}else do i.__d=!1,z&&z(t),f=i.render(i.props,i.state,i.context),i.state=i.__s;while(i.__d&&++X<25);i.state=i.__s,i.getChildContext!=null&&(r=H(H({},r),i.getChildContext())),g&&!h&&i.getSnapshotBeforeUpdate!=null&&(m=i.getSnapshotBeforeUpdate(p,d)),$=f,f!=null&&f.type===P&&f.key==null&&($=ye(f.props.children)),l=he(e,F($)?$:[$],t,n,r,a,o,s,l,u,c),i.base=t.__e,t.__u&=-161,i.__h.length&&s.push(i),v&&(i.__E=i.__=null)}catch(L){if(t.__v=null,u||o!=null)if(L.then){for(t.__u|=u?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;o[o.indexOf(l)]=null,t.__e=l}else{for(J=o.length;J--;)Z(o[J]);te(t)}else t.__e=n.__e,t.__k=n.__k,L.then||te(t);x.__e(L,t,n)}else o==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):l=t.__e=Ye(n.__e,t,n,r,a,o,s,u,c);return(f=x.diffed)&&f(t),128&t.__u?void 0:l}function te(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(te)}function ge(e,t,n){for(var r=0;r<n.length;r++)ne(n[r],n[++r],n[++r]);x.__c&&x.__c(t,e),e.some(function(a){try{e=a.__h,a.__h=[],e.some(function(o){o.call(a)})}catch(o){x.__e(o,a.__v)}})}function ye(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:F(e)?e.map(ye):H({},e)}function Ye(e,t,n,r,a,o,s,l,u){var c,f,i,h,p,d,m,v=n.props||Y,b=t.props,g=t.type;if(g=="svg"?a="http://www.w3.org/2000/svg":g=="math"?a="http://www.w3.org/1998/Math/MathML":a||(a="http://www.w3.org/1999/xhtml"),o!=null){for(c=0;c<o.length;c++)if((p=o[c])&&"setAttribute"in p==!!g&&(g?p.localName==g:p.nodeType==3)){e=p,o[c]=null;break}}if(e==null){if(g==null)return document.createTextNode(b);e=document.createElementNS(a,g,b.is&&b),l&&(x.__m&&x.__m(t,o),l=!1),o=null}if(g==null)v===b||l&&e.data==b||(e.data=b);else{if(o=o&&A.call(e.childNodes),!l&&o!=null)for(v={},c=0;c<e.attributes.length;c++)v[(p=e.attributes[c]).name]=p.value;for(c in v)if(p=v[c],c!="children"){if(c=="dangerouslySetInnerHTML")i=p;else if(!(c in b)){if(c=="value"&&"defaultValue"in b||c=="checked"&&"defaultChecked"in b)continue;W(e,c,null,p,a)}}for(c in b)p=b[c],c=="children"?h=p:c=="dangerouslySetInnerHTML"?f=p:c=="value"?d=p:c=="checked"?m=p:l&&typeof p!="function"||v[c]===p||W(e,c,p,v[c],a);if(f)l||i&&(f.__html==i.__html||f.__html==e.innerHTML)||(e.innerHTML=f.__html),t.__k=[];else if(i&&(e.innerHTML=""),he(t.type=="template"?e.content:e,F(h)?h:[h],t,n,r,g=="foreignObject"?"http://www.w3.org/1999/xhtml":a,o,s,o?o[0]:n.__k&&U(n,0),l,u),o!=null)for(c=o.length;c--;)Z(o[c]);l||(c="value",g=="progress"&&d==null?e.removeAttribute("value"):d!=null&&(d!==e[c]||g=="progress"&&!d||g=="option"&&d!=v[c])&&W(e,c,d,v[c],a),c="checked",m!=null&&m!=e[c]&&W(e,c,m,v[c],a))}return e}function ne(e,t,n){try{if(typeof e=="function"){var r=typeof e.__u=="function";r&&e.__u(),r&&t==null||(e.__u=e(t))}else e.current=t}catch(a){x.__e(a,n)}}function xe(e,t,n){var r,a;if(x.unmount&&x.unmount(e),(r=e.ref)&&(r.current&&r.current!=e.__e||ne(r,null,t)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){x.__e(o,t)}r.base=r.__P=null}if(r=e.__k)for(a=0;a<r.length;a++)r[a]&&xe(r[a],t,n||typeof e.type!="function");n||Z(e.__e),e.__c=e.__=e.__e=void 0}function Ie(e,t,n){return this.constructor(e,n)}function Xe(e,t,n){var r,a,o,s;t==document&&(t=document.documentElement),x.__&&x.__(e,t),a=(r=!1)?null:t.__k,o=[],s=[],ee(t,e=t.__k=De(P,null,[e]),a||Y,Y,t.namespaceURI,a?null:t.firstChild?A.call(t.childNodes):null,o,a?a.__e:t.firstChild,r,s),ge(o,e,s)}A=pe.slice,x={__e:function(e,t,n,r){for(var a,o,s;t=t.__;)if((a=t.__c)&&!a.__)try{if((o=a.constructor)&&o.getDerivedStateFromError!=null&&(a.setState(o.getDerivedStateFromError(e)),s=a.__d),a.componentDidCatch!=null&&(a.componentDidCatch(e,r||{}),s=a.__d),s)return a.__E=a}catch(l){e=l}throw e}},le=0,j.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=H({},this.state),typeof e=="function"&&(e=e(H({},n),this.props)),e&&H(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),fe(this))},j.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),fe(this))},j.prototype.render=P,D=[],ce=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,_e=function(e,t){return e.__v.__b-t.__v.__b},B.__r=0,de=/(PointerCapture)$|Capture$/i,K=0,V=ve(!1),Q=ve(!0);var Ae=0;function _(e,t,n,r,a,o){t||(t={});var s,l,u=t;if("ref"in u)for(l in u={},t)l=="ref"?s=t[l]:u[l]=t[l];var c={type:e,props:u,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Ae,__i:-1,__u:0,__source:a,__self:o};if(typeof e=="function"&&(s=e.defaultProps))for(l in s)u[l]===void 0&&(u[l]=s[l]);return x.vnode&&x.vnode(c),c}var I,k,oe,we,q=0,ke=[],E=x,Ee=E.__b,Ce=E.__r,Se=E.diffed,$e=E.__c,Te=E.unmount,Me=E.__;function re(e,t){E.__h&&E.__h(k,e,q||t),q=0;var n=k.__H||(k.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function S(e){return q=1,Fe(He,e)}function Fe(e,t,n){var r=re(I++,2);if(r.t=e,!r.__c&&(r.__=[He(void 0,t),function(l){var u=r.__N?r.__N[0]:r.__[0],c=r.t(u,l);u!==c&&(r.__N=[c,r.__[1]],r.__c.setState({}))}],r.__c=k,!k.__f)){var a=function(l,u,c){if(!r.__c.__H)return!0;var f=r.__c.__H.__.filter(function(h){return!!h.__c});if(f.every(function(h){return!h.__N}))return!o||o.call(this,l,u,c);var i=r.__c.props!==l;return f.forEach(function(h){if(h.__N){var p=h.__[0];h.__=h.__N,h.__N=void 0,p!==h.__[0]&&(i=!0)}}),o&&o.call(this,l,u,c)||i};k.__f=!0;var o=k.shouldComponentUpdate,s=k.componentWillUpdate;k.componentWillUpdate=function(l,u,c){if(this.__e){var f=o;o=void 0,a(l,u,c),o=f}s&&s.call(this,l,u,c)},k.shouldComponentUpdate=a}return r.__N||r.__}function N(e,t){var n=re(I++,3);!E.__s&&Ne(n.__H,t)&&(n.__=e,n.u=t,k.__H.__h.push(n))}function Re(e,t){var n=re(I++,7);return Ne(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function T(e,t){return q=8,Re(function(){return e},t)}function je(){for(var e;e=ke.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(G),e.__H.__h.forEach(ie),e.__H.__h=[]}catch(t){e.__H.__h=[],E.__e(t,e.__v)}}E.__b=function(e){k=null,Ee&&Ee(e)},E.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),Me&&Me(e,t)},E.__r=function(e){Ce&&Ce(e),I=0;var t=(k=e.__c).__H;t&&(oe===k?(t.__h=[],k.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(G),t.__h.forEach(ie),t.__h=[],I=0)),oe=k},E.diffed=function(e){Se&&Se(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(ke.push(t)!==1&&we===E.requestAnimationFrame||((we=E.requestAnimationFrame)||Be)(je)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),oe=k=null},E.__c=function(e,t){t.some(function(n){try{n.__h.forEach(G),n.__h=n.__h.filter(function(r){return!r.__||ie(r)})}catch(r){t.some(function(a){a.__h&&(a.__h=[])}),t=[],E.__e(r,n.__v)}}),$e&&$e(e,t)},E.unmount=function(e){Te&&Te(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{G(r)}catch(a){t=a}}),n.__H=void 0,t&&E.__e(t,n.__v))};var Le=typeof requestAnimationFrame=="function";function Be(e){var t,n=function(){clearTimeout(r),Le&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,35);Le&&(t=requestAnimationFrame(n))}function G(e){var t=k,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),k=t}function ie(e){var t=k;e.__c=e.__(),k=t}function Ne(e,t){return!e||e.length!==t.length||t.some(function(n,r){return n!==e[r]})}function He(e,t){return typeof t=="function"?t(e):t}const We=()=>_("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:_("path",{d:"M4 6h16M4 12h16M4 18h16"})}),qe=()=>_("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:_("path",{d:"M6 18L18 6M6 6l12 12"})}),Ge=()=>_("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[_("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),_("path",{d:"M9 3v18M3 9h18"})]}),Je=()=>_("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[_("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2","stroke-dasharray":"4 2"}),_("path",{d:"M8 8h8v8H8z"})]}),Ke=({sidebarOpen:e,onToggleSidebar:t,selectionMode:n,onSetSelectionMode:r})=>_("div",{class:"pa-toolbar",children:[_("button",{class:`pa-toolbar-btn ${n==="element"?"active":""}`,onClick:()=>r(n==="element"?"none":"element"),title:"Select element (E)",children:_(Ge,{})}),_("button",{class:`pa-toolbar-btn ${n==="rect"?"active":""}`,onClick:()=>r(n==="rect"?"none":"rect"),title:"Draw rectangle (R)",children:_(Je,{})}),_("button",{class:"pa-toolbar-btn",onClick:t,title:"Toggle sidebar (S)",children:e?_(qe,{}):_(We,{})})]}),Ve=({selection:e,existingAnnotation:t,onSubmit:n,onCancel:r,onDelete:a})=>{const[o,s]=S(t?.title||""),[l,u]=S(t?.body||"");return N(()=>{t&&(s(t.title),u(t.body))},[t]),_("form",{class:"pa-form",onSubmit:f=>{f.preventDefault(),o.trim()&&n({title:o.trim(),body:l.trim()})},children:[e&&_("div",{class:"pa-form-group",children:[_("label",{class:"pa-form-label",children:"Selection"}),_("div",{style:{fontSize:"12px",color:"#6b7280",padding:"8px",background:"#f9fafb",borderRadius:"4px"},children:e.type==="element"?_(P,{children:[_("div",{children:[_("strong",{children:"Type:"})," Element"]}),_("div",{style:{wordBreak:"break-all"},children:[_("strong",{children:"Selector:"})," ",e.selector]})]}):_(P,{children:[_("div",{children:[_("strong",{children:"Type:"})," Rectangle"]}),_("div",{children:[_("strong",{children:"Position:"})," ",Math.round(e.x),", ",Math.round(e.y)]}),_("div",{children:[_("strong",{children:"Size:"})," ",Math.round(e.width)," x ",Math.round(e.height)]})]})})]}),_("div",{class:"pa-form-group",children:[_("label",{class:"pa-form-label",for:"pa-title",children:"Title *"}),_("input",{id:"pa-title",type:"text",class:"pa-form-input",value:o,onInput:f=>s(f.target.value),placeholder:"Brief description",required:!0})]}),_("div",{class:"pa-form-group",children:[_("label",{class:"pa-form-label",for:"pa-body",children:"Details"}),_("textarea",{id:"pa-body",class:"pa-form-input pa-form-textarea",value:l,onInput:f=>u(f.target.value),placeholder:"Additional context, suggestions, or feedback..."})]}),_("div",{class:"pa-form-actions",children:[t&&a&&_("button",{type:"button",class:"pa-btn pa-btn-danger",onClick:a,children:"Delete"}),_("button",{type:"button",class:"pa-btn pa-btn-secondary",onClick:r,children:"Cancel"}),_("button",{type:"submit",class:"pa-btn pa-btn-primary",children:t?"Update":"Save"})]})]})},Qe=()=>_("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:_("path",{d:"M6 18L18 6M6 6l12 12"})}),Ze=({open:e,onClose:t,annotations:n,loading:r,selection:a,selectedAnnotation:o,onSelectAnnotation:s,onCreateAnnotation:l,onUpdateAnnotation:u,onDeleteAnnotation:c,onCancelSelection:f,basePath:i})=>{const[h,p]=S("list"),d=a||o,m=w=>{l(w),p("list")},v=w=>{o&&(u(o.id,w),s(null),p("list"))},b=()=>{o&&(c(o.id),s(null),p("list"))},g=()=>{f(),s(null),p("list")},C=w=>{const O=new Date(w);return O.toLocaleDateString()+" "+O.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};return _("div",{class:`pa-sidebar ${e?"open":""}`,children:[_("div",{class:"pa-sidebar-header",children:[_("h2",{class:"pa-sidebar-title",children:"Annotations"}),_("button",{class:"pa-close-btn",onClick:t,children:_(Qe,{})})]}),!d&&_("div",{class:"pa-tabs",children:_("button",{class:`pa-tab ${h==="list"?"active":""}`,onClick:()=>p("list"),children:["List (",n.length,")"]})}),_("div",{class:"pa-sidebar-content",children:d?_(Ve,{selection:a,existingAnnotation:o,onSubmit:o?v:m,onCancel:g,onDelete:o?b:void 0}):_(P,{children:r?_("div",{class:"pa-empty-state",children:"Loading..."}):n.length===0?_("div",{class:"pa-empty-state",children:[_("p",{children:"No annotations yet"}),_("p",{style:{fontSize:"12px",marginTop:"8px"},children:"Use the toolbar to select an element or draw a rectangle"})]}):_("div",{class:"pa-annotation-list",children:n.map(w=>_("div",{class:"pa-annotation-item",onClick:()=>s(w),children:[_("div",{class:"pa-annotation-item-title",children:w.title}),w.body&&_("div",{class:"pa-annotation-item-body",children:w.body}),_("div",{class:"pa-annotation-item-meta",children:[w.anchor_type," â€¢ ",C(w.created_at)]})]},w.id))})})}),_("div",{class:"pa-sidebar-footer",children:_("a",{href:`${i}/dashboard`,target:"_blank",rel:"noopener noreferrer",class:"pa-btn pa-btn-secondary",style:{display:"block",textAlign:"center",textDecoration:"none"},children:"Open Dashboard"})})]})},et=({mode:e,hoveredRect:t,rectDrag:n})=>_(P,{children:[e!=="none"&&_("div",{class:"pa-mode-indicator",children:[e==="element"?"Click to select element":"Drag to draw rectangle",_("kbd",{children:"ESC"})," to cancel"]}),e==="element"&&t&&_("div",{class:"pa-element-highlight",style:{left:`${t.left}px`,top:`${t.top}px`,width:`${t.width}px`,height:`${t.height}px`}}),e==="rect"&&n&&_("div",{class:"pa-selection-rect",style:{left:`${Math.min(n.startX,n.endX)}px`,top:`${Math.min(n.startY,n.endY)}px`,width:`${Math.abs(n.endX-n.startX)}px`,height:`${Math.abs(n.endY-n.startY)}px`}})]}),tt=({annotation:e,index:t,isActive:n,onClick:r})=>{const[a,o]=S(null),s=T(()=>{const l=e.anchor_payload;if(e.anchor_type==="element"&&"selector"in l){try{const u=document.querySelector(l.selector);if(u){const c=u.getBoundingClientRect();return{left:c.right-12,top:c.top-12}}}catch{}return null}if(e.anchor_type==="rect"&&"x"in l){const{x:u,y:c,width:f,scrollX:i,scrollY:h,viewportWidth:p,viewportHeight:d}=l,m=window.innerWidth/p,v=window.innerHeight/d,b=(u+i)*m,g=(c+h)*v;return{left:b-window.scrollX+f*m-12,top:g-window.scrollY-12}}return null},[e]);return N(()=>{o(s());const l=()=>{o(s())};return window.addEventListener("scroll",l,{passive:!0}),window.addEventListener("resize",l,{passive:!0}),()=>{window.removeEventListener("scroll",l),window.removeEventListener("resize",l)}},[s]),a?_("div",{class:`pa-marker ${n?"active":""}`,style:{left:`${a.left}px`,top:`${a.top}px`},onClick:r,title:e.title,children:t+1}):null};function nt(e,t){const[n,r]=S([]),[a,o]=S(!0),[s,l]=S(null),[u,c]=S(()=>window.location.origin+window.location.pathname),f=T(async()=>{const d=window.location.origin+window.location.pathname;c(d),o(!0),l(null);try{const v=await(await fetch(`${e}/annotations/by-url?url=${encodeURIComponent(d)}`)).json();v.success?r(v.data):l(v.error||"Failed to fetch annotations")}catch(m){l(String(m))}finally{o(!1)}},[e]);N(()=>{f()},[]);const i=T(async d=>{try{const v=await(await fetch(`${e}/annotations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...d,actor:d.actor||t})})).json();return v.success?(r(b=>[v.data,...b]),v.data):(l(v.error||"Failed to create annotation"),null)}catch(m){return l(String(m)),null}},[e,t]),h=T(async(d,m)=>{try{const b=await(await fetch(`${e}/annotations/${d}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({...m,actor:m.actor||t})})).json();return b.success?(r(g=>g.map(C=>C.id===d?b.data:C)),b.data):(l(b.error||"Failed to update annotation"),null)}catch(v){return l(String(v)),null}},[e,t]),p=T(async d=>{try{const v=await(await fetch(`${e}/annotations/${d}?actor=${encodeURIComponent(t)}`,{method:"DELETE"})).json();return v.success?(r(b=>b.filter(g=>g.id!==d)),!0):(l(v.error||"Failed to delete annotation"),!1)}catch(m){return l(String(m)),!1}},[e,t]);return{annotations:n,loading:a,error:s,refresh:f,create:i,update:h,remove:p,currentUrl:u}}function ot(e){if(e.id)return`#${e.id}`;const t=[];let n=e;for(;n&&n!==document.body;){let r=n.tagName.toLowerCase();if(n.className&&typeof n.className=="string"){const o=n.className.split(" ").filter(s=>s.trim()&&!s.startsWith("pa-")).slice(0,2);o.length>0&&(r+="."+o.join("."))}const a=n.parentElement?.children;if(a&&a.length>1){const o=Array.from(a).indexOf(n);o>0&&(r+=`:nth-child(${o+1})`)}t.unshift(r),n=n.parentElement}return t.join(" > ")}function rt(e){const t=[];let n=e;for(;n&&n.nodeType===Node.ELEMENT_NODE;){let r=0,a=n.previousSibling;for(;a;)a.nodeType===Node.ELEMENT_NODE&&a.tagName===n.tagName&&r++,a=a.previousSibling;const o=n.tagName.toLowerCase(),s=r>0?`${o}[${r+1}]`:o;t.unshift(s),n=n.parentElement}return"/"+t.join("/")}function ae(e){return e.composedPath().some(n=>n instanceof HTMLElement?n.id==="prototype-annotator-root"||n.id==="prototype-annotator-container":!1)}function it(){const[e,t]=S("none"),[n,r]=S(null),[a,o]=S(null),[s,l]=S(null),[u,c]=S(null),f=T(()=>{r(null),o(null),l(null),c(null)},[]);return N(()=>{if(e!=="element"){o(null),l(null);return}const i=p=>{if(ae(p)){o(null),l(null);return}const d=p.target;o(d),l(d.getBoundingClientRect())},h=p=>{if(ae(p))return;p.preventDefault(),p.stopPropagation();const d=p.target,m=d.getBoundingClientRect();r({type:"element",selector:ot(d),xpath:rt(d),textContent:d.textContent?.slice(0,100)||"",rect:m}),t("none")};return document.addEventListener("mousemove",i),document.addEventListener("click",h,!0),()=>{document.removeEventListener("mousemove",i),document.removeEventListener("click",h,!0)}},[e]),N(()=>{if(e!=="rect"){c(null);return}const i=d=>{ae(d)||(d.preventDefault(),c({startX:d.clientX,startY:d.clientY,endX:d.clientX,endY:d.clientY}))},h=d=>{c(m=>m?{...m,endX:d.clientX,endY:d.clientY}:null)},p=d=>{c(m=>{if(!m)return null;const v=Math.min(m.startX,d.clientX),b=Math.min(m.startY,d.clientY),g=Math.abs(d.clientX-m.startX),C=Math.abs(d.clientY-m.startY);return g>10&&C>10&&r({type:"rect",x:v,y:b,width:g,height:C,scrollX:window.scrollX,scrollY:window.scrollY,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight}),t("none"),null})};return document.addEventListener("mousedown",i),document.addEventListener("mousemove",h),document.addEventListener("mouseup",p),()=>{document.removeEventListener("mousedown",i),document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",p)}},[e]),N(()=>{const i=h=>{h.key==="Escape"&&e!=="none"&&(t("none"),f())};return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[e,f]),{mode:e,setMode:t,selection:n,clearSelection:f,hoveredElement:a,hoveredRect:s,rectDrag:u}}const at=({config:e})=>{const[t,n]=S(!1),[r,a]=S(null),{annotations:o,loading:s,create:l,update:u,remove:c,currentUrl:f,refresh:i}=nt(e.apiUrl,e.defaultActor),{mode:h,setMode:p,selection:d,clearSelection:m,hoveredRect:v,rectDrag:b}=it();N(()=>{d&&n(!0)},[d]),N(()=>{m(),a(null)},[f,m]),N(()=>{window.__PROTOTYPE_ANNOTATOR__={refresh:i};const y=()=>i();return window.addEventListener("popstate",y),()=>{delete window.__PROTOTYPE_ANNOTATOR__,window.removeEventListener("popstate",y)}},[i]),N(()=>{const y=$=>{if(!$.composedPath().some(L=>L instanceof HTMLInputElement||L instanceof HTMLTextAreaElement))switch($.key.toLowerCase()){case"e":p(h==="element"?"none":"element");break;case"r":p(h==="rect"?"none":"rect");break;case"s":n(L=>!L);break}};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[h,p]);const g=T(y=>{p(y),m(),a(null)},[p,m]),C=T(async y=>{if(!d)return;const $={url_full:window.location.href,title:y.title,body:y.body,anchor_type:d.type,anchor_payload:d.type==="element"?{selector:d.selector,xpath:d.xpath,textContent:d.textContent}:{x:d.x,y:d.y,width:d.width,height:d.height,scrollX:d.scrollX,scrollY:d.scrollY,viewportWidth:d.viewportWidth,viewportHeight:d.viewportHeight}};await l($),m()},[d,l,m]),w=T(async(y,$)=>{await u(y,$)},[u]),O=T(async y=>{await c(y)},[c]),z=T(()=>{m()},[m]),X=T(y=>{a(y),y&&n(!0)},[]);return _(P,{children:[_(et,{mode:h,hoveredRect:v,rectDrag:b}),o.map((y,$)=>_(tt,{annotation:y,index:$,isActive:r?.id===y.id,onClick:()=>X(y)},y.id)),_(Ze,{open:t,onClose:()=>n(!1),annotations:o,loading:s,selection:d,selectedAnnotation:r,onSelectAnnotation:X,onCreateAnnotation:C,onUpdateAnnotation:w,onDeleteAnnotation:O,onCancelSelection:z,basePath:e.basePath}),_(Ke,{sidebarOpen:t,onToggleSidebar:()=>n(y=>!y),selectionMode:h,onSetSelectionMode:g})]})},lt=":host{all:initial;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,sans-serif;font-size:14px;line-height:1.5;color:#1a1a1a}*{box-sizing:border-box}.pa-toolbar{position:fixed;bottom:20px;right:20px;display:flex;gap:8px;z-index:999999}.pa-toolbar-btn{width:48px;height:48px;border-radius:50%;border:none;background:#2563eb;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px #00000026;transition:transform .15s,background .15s}.pa-toolbar-btn:hover{transform:scale(1.05);background:#1d4ed8}.pa-toolbar-btn.active{background:#dc2626}.pa-toolbar-btn svg{width:24px;height:24px}.pa-sidebar{position:fixed;top:0;left:0;width:360px;height:100vh;background:#fff;box-shadow:4px 0 20px #0000001a;z-index:999998;transform:translate(-100%);transition:transform .3s ease;display:flex;flex-direction:column}.pa-sidebar.open{transform:translate(0)}.pa-sidebar-header{padding:16px 20px;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;justify-content:space-between}.pa-sidebar-title{font-size:16px;font-weight:600;margin:0}.pa-close-btn{background:none;border:none;cursor:pointer;padding:4px;border-radius:4px;color:#6b7280}.pa-close-btn:hover{background:#f3f4f6;color:#1a1a1a}.pa-sidebar-content{flex:1;overflow-y:auto;padding:16px 20px}.pa-sidebar-footer{padding:16px 20px;border-top:1px solid #e5e7eb}.pa-annotation-list{display:flex;flex-direction:column;gap:12px}.pa-annotation-item{padding:12px;background:#f9fafb;border-radius:8px;border:1px solid #e5e7eb;cursor:pointer;transition:border-color .15s}.pa-annotation-item:hover{border-color:#2563eb}.pa-annotation-item-title{font-weight:500;margin-bottom:4px}.pa-annotation-item-body{font-size:13px;color:#6b7280;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.pa-annotation-item-meta{font-size:11px;color:#9ca3af;margin-top:8px}.pa-empty-state{text-align:center;padding:32px 16px;color:#6b7280}.pa-form{display:flex;flex-direction:column;gap:16px}.pa-form-group{display:flex;flex-direction:column;gap:4px}.pa-form-label{font-size:13px;font-weight:500;color:#374151}.pa-form-input{padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:14px;outline:none;transition:border-color .15s}.pa-form-input:focus{border-color:#2563eb}.pa-form-textarea{min-height:100px;resize:vertical}.pa-form-actions{display:flex;gap:8px;justify-content:flex-end}.pa-btn{padding:8px 16px;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background .15s}.pa-btn-primary{background:#2563eb;color:#fff;border:none}.pa-btn-primary:hover{background:#1d4ed8}.pa-btn-secondary{background:#fff;color:#374151;border:1px solid #d1d5db}.pa-btn-secondary:hover{background:#f9fafb}.pa-btn-danger{background:#dc2626;color:#fff;border:none}.pa-btn-danger:hover{background:#b91c1c}.pa-selection-overlay{position:fixed;inset:0;z-index:999997;cursor:crosshair}.pa-selection-rect{position:fixed;border:2px dashed #2563eb;background:#2563eb1a;pointer-events:none;z-index:999997}.pa-element-highlight{position:fixed;border:2px solid #2563eb;background:#2563eb1a;pointer-events:none;z-index:999997}.pa-marker{position:fixed;width:24px;height:24px;background:#2563eb;border-radius:50%;color:#fff;font-size:12px;font-weight:600;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:999996;box-shadow:0 2px 8px #0003;transition:transform .15s}.pa-marker:hover{transform:scale(1.1)}.pa-marker.active{background:#dc2626}.pa-mode-indicator{position:fixed;top:20px;left:50%;transform:translate(-50%);padding:8px 16px;background:#1a1a1a;color:#fff;border-radius:20px;font-size:13px;z-index:999999;display:flex;align-items:center;gap:8px}.pa-mode-indicator kbd{background:#fff3;padding:2px 6px;border-radius:4px;font-size:11px}.pa-tabs{display:flex;border-bottom:1px solid #e5e7eb;margin-bottom:16px}.pa-tab{padding:8px 16px;background:none;border:none;cursor:pointer;font-size:14px;color:#6b7280;border-bottom:2px solid transparent;margin-bottom:-1px}.pa-tab.active{color:#2563eb;border-bottom-color:#2563eb}.pa-tab:hover:not(.active){color:#374151}";function Pe(){const e=window.__PROTOTYPE_ANNOTATOR_CONFIG__;if(!e){console.error("[prototype-annotator] No configuration found");return}if(document.getElementById("prototype-annotator-root"))return;const t=document.createElement("div");t.id="prototype-annotator-root",document.body.appendChild(t);const n=t.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=lt,n.appendChild(r);const a=document.createElement("div");a.id="prototype-annotator-container",n.appendChild(a),Xe(_(at,{config:e}),a),console.log("[prototype-annotator] Overlay mounted")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Pe):Pe()})();
//# sourceMappingURL=overlay.js.map
