(function(){"use strict";var X,y,le,D,se,ce,_e,de,K,V,Q,Y={},pe=[],Oe=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,A=Array.isArray;function H(e,t){for(var n in t)e[n]=t[n];return e}function Z(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function De(e,t,n){var r,a,o,s={};for(o in t)o=="key"?r=t[o]:o=="ref"?a=t[o]:s[o]=t[o];if(arguments.length>2&&(s.children=arguments.length>3?X.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(o in e.defaultProps)s[o]===void 0&&(s[o]=e.defaultProps[o]);return F(e,s,r,a,null)}function F(e,t,n,r,a){var o={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:a??++le,__i:-1,__u:0};return a==null&&y.vnode!=null&&y.vnode(o),o}function P(e){return e.children}function j(e,t){this.props=e,this.context=t}function U(e,t){if(t==null)return e.__?U(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?U(e):null}function ue(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return ue(e)}}function he(e){(!e.__d&&(e.__d=!0)&&D.push(e)&&!B.__r++||se!=y.debounceRendering)&&((se=y.debounceRendering)||ce)(B)}function B(){for(var e,t,n,r,a,o,s,l=1;D.length;)D.length>l&&D.sort(_e),e=D.shift(),l=D.length,e.__d&&(n=void 0,r=void 0,a=(r=(t=e).__v).__e,o=[],s=[],t.__P&&((n=H({},r)).__v=r.__v+1,y.vnode&&y.vnode(n),ee(t.__P,n,r,t.__n,t.__P.namespaceURI,32&r.__u?[a]:null,o,a??U(r),!!(32&r.__u),s),n.__v=r.__v,n.__.__k[n.__i]=n,ge(o,n,s),r.__e=r.__=null,n.__e!=a&&ue(n)));B.__r=0}function fe(e,t,n,r,a,o,s,l,u,c,h){var i,m,p,d,f,g,v,b=r&&r.__k||pe,S=t.length;for(u=ze(n,t,b,u,S),i=0;i<S;i++)(p=n.__k[i])!=null&&(m=p.__i==-1?Y:b[p.__i]||Y,p.__i=i,g=ee(e,p,m,a,o,s,l,u,c,h),d=p.__e,p.ref&&m.ref!=p.ref&&(m.ref&&ne(m.ref,null,p),h.push(p.ref,p.__c||d,p)),f==null&&d!=null&&(f=d),(v=!!(4&p.__u))||m.__k===p.__k?u=me(p,u,e,v):typeof p.type=="function"&&g!==void 0?u=g:d&&(u=d.nextSibling),p.__u&=-7);return n.__e=f,u}function ze(e,t,n,r,a){var o,s,l,u,c,h=n.length,i=h,m=0;for(e.__k=new Array(a),o=0;o<a;o++)(s=t[o])!=null&&typeof s!="boolean"&&typeof s!="function"?(typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?s=e.__k[o]=F(null,s,null,null,null):A(s)?s=e.__k[o]=F(P,{children:s},null,null,null):s.constructor===void 0&&s.__b>0?s=e.__k[o]=F(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):e.__k[o]=s,u=o+m,s.__=e,s.__b=e.__b+1,l=null,(c=s.__i=Ue(s,n,u,i))!=-1&&(i--,(l=n[c])&&(l.__u|=2)),l==null||l.__v==null?(c==-1&&(a>h?m--:a<h&&m++),typeof s.type!="function"&&(s.__u|=4)):c!=u&&(c==u-1?m--:c==u+1?m++:(c>u?m--:m++,s.__u|=4))):e.__k[o]=null;if(i)for(o=0;o<h;o++)(l=n[o])!=null&&(2&l.__u)==0&&(l.__e==r&&(r=U(l)),xe(l,l));return r}function me(e,t,n,r){var a,o;if(typeof e.type=="function"){for(a=e.__k,o=0;a&&o<a.length;o++)a[o]&&(a[o].__=e,t=me(a[o],t,n,r));return t}e.__e!=t&&(r&&(t&&e.type&&!t.parentNode&&(t=U(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Ue(e,t,n,r){var a,o,s,l=e.key,u=e.type,c=t[n],h=c!=null&&(2&c.__u)==0;if(c===null&&l==null||h&&l==c.key&&u==c.type)return n;if(r>(h?1:0)){for(a=n-1,o=n+1;a>=0||o<t.length;)if((c=t[s=a>=0?a--:o++])!=null&&(2&c.__u)==0&&l==c.key&&u==c.type)return s}return-1}function be(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||Oe.test(t)?n:n+"px"}function W(e,t,n,r,a){var o,s;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||be(e.style,t,"");if(n)for(t in n)r&&n[t]==r[t]||be(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")o=t!=(t=t.replace(de,"$1")),s=t.toLowerCase(),t=s in e||t=="onFocusOut"||t=="onFocusIn"?s.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?r?n.u=r.u:(n.u=K,e.addEventListener(t,o?Q:V,o)):e.removeEventListener(t,o?Q:V,o);else{if(a=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function ve(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=K++;else if(t.t<n.u)return;return n(y.event?y.event(t):t)}}}function ee(e,t,n,r,a,o,s,l,u,c){var h,i,m,p,d,f,g,v,b,S,w,O,z,R,x,$,J,L=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(u=!!(32&n.__u),o=[l=t.__e=n.__e]),(h=y.__b)&&h(t);e:if(typeof L=="function")try{if(v=t.props,b="prototype"in L&&L.prototype.render,S=(h=L.contextType)&&r[h.__c],w=h?S?S.props.value:h.__:r,n.__c?g=(i=t.__c=n.__c).__=i.__E:(b?t.__c=i=new L(v,w):(t.__c=i=new j(v,w),i.constructor=L,i.render=Ie),S&&S.sub(i),i.state||(i.state={}),i.__n=r,m=i.__d=!0,i.__h=[],i._sb=[]),b&&i.__s==null&&(i.__s=i.state),b&&L.getDerivedStateFromProps!=null&&(i.__s==i.state&&(i.__s=H({},i.__s)),H(i.__s,L.getDerivedStateFromProps(v,i.__s))),p=i.props,d=i.state,i.__v=t,m)b&&L.getDerivedStateFromProps==null&&i.componentWillMount!=null&&i.componentWillMount(),b&&i.componentDidMount!=null&&i.__h.push(i.componentDidMount);else{if(b&&L.getDerivedStateFromProps==null&&v!==p&&i.componentWillReceiveProps!=null&&i.componentWillReceiveProps(v,w),t.__v==n.__v||!i.__e&&i.shouldComponentUpdate!=null&&i.shouldComponentUpdate(v,i.__s,w)===!1){for(t.__v!=n.__v&&(i.props=v,i.state=i.__s,i.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(N){N&&(N.__=t)}),O=0;O<i._sb.length;O++)i.__h.push(i._sb[O]);i._sb=[],i.__h.length&&s.push(i);break e}i.componentWillUpdate!=null&&i.componentWillUpdate(v,i.__s,w),b&&i.componentDidUpdate!=null&&i.__h.push(function(){i.componentDidUpdate(p,d,f)})}if(i.context=w,i.props=v,i.__P=e,i.__e=!1,z=y.__r,R=0,b){for(i.state=i.__s,i.__d=!1,z&&z(t),h=i.render(i.props,i.state,i.context),x=0;x<i._sb.length;x++)i.__h.push(i._sb[x]);i._sb=[]}else do i.__d=!1,z&&z(t),h=i.render(i.props,i.state,i.context),i.state=i.__s;while(i.__d&&++R<25);i.state=i.__s,i.getChildContext!=null&&(r=H(H({},r),i.getChildContext())),b&&!m&&i.getSnapshotBeforeUpdate!=null&&(f=i.getSnapshotBeforeUpdate(p,d)),$=h,h!=null&&h.type===P&&h.key==null&&($=ye(h.props.children)),l=fe(e,A($)?$:[$],t,n,r,a,o,s,l,u,c),i.base=t.__e,t.__u&=-161,i.__h.length&&s.push(i),g&&(i.__E=i.__=null)}catch(N){if(t.__v=null,u||o!=null)if(N.then){for(t.__u|=u?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;o[o.indexOf(l)]=null,t.__e=l}else{for(J=o.length;J--;)Z(o[J]);te(t)}else t.__e=n.__e,t.__k=n.__k,N.then||te(t);y.__e(N,t,n)}else o==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):l=t.__e=Ye(n.__e,t,n,r,a,o,s,u,c);return(h=y.diffed)&&h(t),128&t.__u?void 0:l}function te(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(te)}function ge(e,t,n){for(var r=0;r<n.length;r++)ne(n[r],n[++r],n[++r]);y.__c&&y.__c(t,e),e.some(function(a){try{e=a.__h,a.__h=[],e.some(function(o){o.call(a)})}catch(o){y.__e(o,a.__v)}})}function ye(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:A(e)?e.map(ye):H({},e)}function Ye(e,t,n,r,a,o,s,l,u){var c,h,i,m,p,d,f,g=n.props||Y,v=t.props,b=t.type;if(b=="svg"?a="http://www.w3.org/2000/svg":b=="math"?a="http://www.w3.org/1998/Math/MathML":a||(a="http://www.w3.org/1999/xhtml"),o!=null){for(c=0;c<o.length;c++)if((p=o[c])&&"setAttribute"in p==!!b&&(b?p.localName==b:p.nodeType==3)){e=p,o[c]=null;break}}if(e==null){if(b==null)return document.createTextNode(v);e=document.createElementNS(a,b,v.is&&v),l&&(y.__m&&y.__m(t,o),l=!1),o=null}if(b==null)g===v||l&&e.data==v||(e.data=v);else{if(o=o&&X.call(e.childNodes),!l&&o!=null)for(g={},c=0;c<e.attributes.length;c++)g[(p=e.attributes[c]).name]=p.value;for(c in g)if(p=g[c],c!="children"){if(c=="dangerouslySetInnerHTML")i=p;else if(!(c in v)){if(c=="value"&&"defaultValue"in v||c=="checked"&&"defaultChecked"in v)continue;W(e,c,null,p,a)}}for(c in v)p=v[c],c=="children"?m=p:c=="dangerouslySetInnerHTML"?h=p:c=="value"?d=p:c=="checked"?f=p:l&&typeof p!="function"||g[c]===p||W(e,c,p,g[c],a);if(h)l||i&&(h.__html==i.__html||h.__html==e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(i&&(e.innerHTML=""),fe(t.type=="template"?e.content:e,A(m)?m:[m],t,n,r,b=="foreignObject"?"http://www.w3.org/1999/xhtml":a,o,s,o?o[0]:n.__k&&U(n,0),l,u),o!=null)for(c=o.length;c--;)Z(o[c]);l||(c="value",b=="progress"&&d==null?e.removeAttribute("value"):d!=null&&(d!==e[c]||b=="progress"&&!d||b=="option"&&d!=g[c])&&W(e,c,d,g[c],a),c="checked",f!=null&&f!=e[c]&&W(e,c,f,g[c],a))}return e}function ne(e,t,n){try{if(typeof e=="function"){var r=typeof e.__u=="function";r&&e.__u(),r&&t==null||(e.__u=e(t))}else e.current=t}catch(a){y.__e(a,n)}}function xe(e,t,n){var r,a;if(y.unmount&&y.unmount(e),(r=e.ref)&&(r.current&&r.current!=e.__e||ne(r,null,t)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){y.__e(o,t)}r.base=r.__P=null}if(r=e.__k)for(a=0;a<r.length;a++)r[a]&&xe(r[a],t,n||typeof e.type!="function");n||Z(e.__e),e.__c=e.__=e.__e=void 0}function Ie(e,t,n){return this.constructor(e,n)}function Re(e,t,n){var r,a,o,s;t==document&&(t=document.documentElement),y.__&&y.__(e,t),a=(r=!1)?null:t.__k,o=[],s=[],ee(t,e=t.__k=De(P,null,[e]),a||Y,Y,t.namespaceURI,a?null:t.firstChild?X.call(t.childNodes):null,o,a?a.__e:t.firstChild,r,s),ge(o,e,s)}X=pe.slice,y={__e:function(e,t,n,r){for(var a,o,s;t=t.__;)if((a=t.__c)&&!a.__)try{if((o=a.constructor)&&o.getDerivedStateFromError!=null&&(a.setState(o.getDerivedStateFromError(e)),s=a.__d),a.componentDidCatch!=null&&(a.componentDidCatch(e,r||{}),s=a.__d),s)return a.__E=a}catch(l){e=l}throw e}},le=0,j.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=H({},this.state),typeof e=="function"&&(e=e(H({},n),this.props)),e&&H(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),he(this))},j.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),he(this))},j.prototype.render=P,D=[],ce=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,_e=function(e,t){return e.__v.__b-t.__v.__b},B.__r=0,de=/(PointerCapture)$|Capture$/i,K=0,V=ve(!1),Q=ve(!0);var Xe=0;function _(e,t,n,r,a,o){t||(t={});var s,l,u=t;if("ref"in u)for(l in u={},t)l=="ref"?s=t[l]:u[l]=t[l];var c={type:e,props:u,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Xe,__i:-1,__u:0,__source:a,__self:o};if(typeof e=="function"&&(s=e.defaultProps))for(l in s)u[l]===void 0&&(u[l]=s[l]);return y.vnode&&y.vnode(c),c}var I,k,oe,we,q=0,ke=[],E=y,Ee=E.__b,Se=E.__r,Ce=E.diffed,$e=E.__c,Te=E.unmount,Me=E.__;function re(e,t){E.__h&&E.__h(k,e,q||t),q=0;var n=k.__H||(k.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function C(e){return q=1,Ae(He,e)}function Ae(e,t,n){var r=re(I++,2);if(r.t=e,!r.__c&&(r.__=[He(void 0,t),function(l){var u=r.__N?r.__N[0]:r.__[0],c=r.t(u,l);u!==c&&(r.__N=[c,r.__[1]],r.__c.setState({}))}],r.__c=k,!k.__f)){var a=function(l,u,c){if(!r.__c.__H)return!0;var h=r.__c.__H.__.filter(function(m){return!!m.__c});if(h.every(function(m){return!m.__N}))return!o||o.call(this,l,u,c);var i=r.__c.props!==l;return h.forEach(function(m){if(m.__N){var p=m.__[0];m.__=m.__N,m.__N=void 0,p!==m.__[0]&&(i=!0)}}),o&&o.call(this,l,u,c)||i};k.__f=!0;var o=k.shouldComponentUpdate,s=k.componentWillUpdate;k.componentWillUpdate=function(l,u,c){if(this.__e){var h=o;o=void 0,a(l,u,c),o=h}s&&s.call(this,l,u,c)},k.shouldComponentUpdate=a}return r.__N||r.__}function M(e,t){var n=re(I++,3);!E.__s&&Ne(n.__H,t)&&(n.__=e,n.u=t,k.__H.__h.push(n))}function Fe(e,t){var n=re(I++,7);return Ne(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function T(e,t){return q=8,Fe(function(){return e},t)}function je(){for(var e;e=ke.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(G),e.__H.__h.forEach(ie),e.__H.__h=[]}catch(t){e.__H.__h=[],E.__e(t,e.__v)}}E.__b=function(e){k=null,Ee&&Ee(e)},E.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),Me&&Me(e,t)},E.__r=function(e){Se&&Se(e),I=0;var t=(k=e.__c).__H;t&&(oe===k?(t.__h=[],k.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(G),t.__h.forEach(ie),t.__h=[],I=0)),oe=k},E.diffed=function(e){Ce&&Ce(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(ke.push(t)!==1&&we===E.requestAnimationFrame||((we=E.requestAnimationFrame)||Be)(je)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),oe=k=null},E.__c=function(e,t){t.some(function(n){try{n.__h.forEach(G),n.__h=n.__h.filter(function(r){return!r.__||ie(r)})}catch(r){t.some(function(a){a.__h&&(a.__h=[])}),t=[],E.__e(r,n.__v)}}),$e&&$e(e,t)},E.unmount=function(e){Te&&Te(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{G(r)}catch(a){t=a}}),n.__H=void 0,t&&E.__e(t,n.__v))};var Le=typeof requestAnimationFrame=="function";function Be(e){var t,n=function(){clearTimeout(r),Le&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,35);Le&&(t=requestAnimationFrame(n))}function G(e){var t=k,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),k=t}function ie(e){var t=k;e.__c=e.__(),k=t}function Ne(e,t){return!e||e.length!==t.length||t.some(function(n,r){return n!==e[r]})}function He(e,t){return typeof t=="function"?t(e):t}const We=()=>_("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:_("path",{d:"M4 6h16M4 12h16M4 18h16"})}),qe=()=>_("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:_("path",{d:"M6 18L18 6M6 6l12 12"})}),Ge=()=>_("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[_("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),_("path",{d:"M9 3v18M3 9h18"})]}),Je=()=>_("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:[_("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2","stroke-dasharray":"4 2"}),_("path",{d:"M8 8h8v8H8z"})]}),Ke=({sidebarOpen:e,onToggleSidebar:t,selectionMode:n,onSetSelectionMode:r})=>_("div",{class:"pa-toolbar",children:[_("button",{class:`pa-toolbar-btn ${n==="element"?"active":""}`,onClick:()=>r(n==="element"?"none":"element"),title:"Select element (E)",children:_(Ge,{})}),_("button",{class:`pa-toolbar-btn ${n==="rect"?"active":""}`,onClick:()=>r(n==="rect"?"none":"rect"),title:"Draw rectangle (R)",children:_(Je,{})}),_("button",{class:"pa-toolbar-btn",onClick:t,title:"Toggle sidebar (S)",children:e?_(qe,{}):_(We,{})})]}),Ve=({selection:e,existingAnnotation:t,onSubmit:n,onCancel:r,onDelete:a})=>{const[o,s]=C(t?.title||""),[l,u]=C(t?.body||"");return M(()=>{t&&(s(t.title),u(t.body))},[t]),_("form",{class:"pa-form",onSubmit:h=>{h.preventDefault(),o.trim()&&n({title:o.trim(),body:l.trim()})},children:[e&&_("div",{class:"pa-form-group",children:[_("label",{class:"pa-form-label",children:"Selection"}),_("div",{style:{fontSize:"12px",color:"#6b7280",padding:"8px",background:"#f9fafb",borderRadius:"4px"},children:e.type==="element"?_(P,{children:[_("div",{children:[_("strong",{children:"Type:"})," Element"]}),_("div",{style:{wordBreak:"break-all"},children:[_("strong",{children:"Selector:"})," ",e.selector]})]}):_(P,{children:[_("div",{children:[_("strong",{children:"Type:"})," Rectangle"]}),_("div",{children:[_("strong",{children:"Position:"})," ",Math.round(e.x),", ",Math.round(e.y)]}),_("div",{children:[_("strong",{children:"Size:"})," ",Math.round(e.width)," x ",Math.round(e.height)]})]})})]}),_("div",{class:"pa-form-group",children:[_("label",{class:"pa-form-label",for:"pa-title",children:"Title *"}),_("input",{id:"pa-title",type:"text",class:"pa-form-input",value:o,onInput:h=>s(h.target.value),placeholder:"Brief description",required:!0})]}),_("div",{class:"pa-form-group",children:[_("label",{class:"pa-form-label",for:"pa-body",children:"Details"}),_("textarea",{id:"pa-body",class:"pa-form-input pa-form-textarea",value:l,onInput:h=>u(h.target.value),placeholder:"Additional context, suggestions, or feedback..."})]}),_("div",{class:"pa-form-actions",children:[t&&a&&_("button",{type:"button",class:"pa-btn pa-btn-danger",onClick:a,children:"Delete"}),_("button",{type:"button",class:"pa-btn pa-btn-secondary",onClick:r,children:"Cancel"}),_("button",{type:"submit",class:"pa-btn pa-btn-primary",children:t?"Update":"Save"})]})]})},Qe=()=>_("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2",children:_("path",{d:"M6 18L18 6M6 6l12 12"})}),Ze=({open:e,onClose:t,annotations:n,loading:r,selection:a,selectedAnnotation:o,onSelectAnnotation:s,onCreateAnnotation:l,onUpdateAnnotation:u,onDeleteAnnotation:c,onCancelSelection:h,basePath:i})=>{const[m,p]=C("list"),d=a||o,f=w=>{l(w),p("list")},g=w=>{o&&(u(o.id,w),s(null),p("list"))},v=()=>{o&&(c(o.id),s(null),p("list"))},b=()=>{h(),s(null),p("list")},S=w=>{const O=new Date(w);return O.toLocaleDateString()+" "+O.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};return _("div",{class:`pa-sidebar ${e?"open":""}`,children:[_("div",{class:"pa-sidebar-header",children:[_("h2",{class:"pa-sidebar-title",children:"Annotations"}),_("button",{class:"pa-close-btn",onClick:t,children:_(Qe,{})})]}),!d&&_("div",{class:"pa-tabs",children:_("button",{class:`pa-tab ${m==="list"?"active":""}`,onClick:()=>p("list"),children:["List (",n.length,")"]})}),_("div",{class:"pa-sidebar-content",children:d?_(Ve,{selection:a,existingAnnotation:o,onSubmit:o?g:f,onCancel:b,onDelete:o?v:void 0}):_(P,{children:r?_("div",{class:"pa-empty-state",children:"Loading..."}):n.length===0?_("div",{class:"pa-empty-state",children:[_("p",{children:"No annotations yet"}),_("p",{style:{fontSize:"12px",marginTop:"8px"},children:"Use the toolbar to select an element or draw a rectangle"})]}):_("div",{class:"pa-annotation-list",children:n.map(w=>_("div",{class:"pa-annotation-item",onClick:()=>s(w),children:[_("div",{class:"pa-annotation-item-title",children:w.title}),w.body&&_("div",{class:"pa-annotation-item-body",children:w.body}),_("div",{class:"pa-annotation-item-meta",children:[w.anchor_type," â€¢ ",S(w.created_at)]})]},w.id))})})}),_("div",{class:"pa-sidebar-footer",children:_("a",{href:`${i}/dashboard`,target:"_blank",rel:"noopener noreferrer",class:"pa-btn pa-btn-secondary",style:{display:"block",textAlign:"center",textDecoration:"none"},children:"Open Dashboard"})})]})},et=({mode:e,hoveredRect:t,rectDrag:n})=>_(P,{children:[e!=="none"&&_("div",{class:"pa-mode-indicator",children:[e==="element"?"Click to select element":"Drag to draw rectangle",_("kbd",{children:"ESC"})," to cancel"]}),e==="element"&&t&&_("div",{class:"pa-element-highlight",style:{left:`${t.left}px`,top:`${t.top}px`,width:`${t.width}px`,height:`${t.height}px`}}),e==="rect"&&n&&_("div",{class:"pa-selection-rect",style:{left:`${Math.min(n.startX,n.endX)}px`,top:`${Math.min(n.startY,n.endY)}px`,width:`${Math.abs(n.endX-n.startX)}px`,height:`${Math.abs(n.endY-n.startY)}px`}})]}),tt=({annotation:e,index:t,isActive:n,onClick:r})=>{const[a,o]=C(null),s=T(()=>{const l=e.anchor_payload;if(e.anchor_type==="element"&&"selector"in l){try{const u=document.querySelector(l.selector);if(u){const c=u.getBoundingClientRect();return{left:c.right-12,top:c.top-12}}}catch{}return null}if(e.anchor_type==="rect"&&"x"in l){const{x:u,y:c,width:h,scrollX:i,scrollY:m,viewportWidth:p,viewportHeight:d}=l,f=window.innerWidth/p,g=window.innerHeight/d,v=(u+i)*f,b=(c+m)*g;return{left:v-window.scrollX+h*f-12,top:b-window.scrollY-12}}return null},[e]);return M(()=>{o(s());const l=()=>{o(s())};return window.addEventListener("scroll",l,{passive:!0}),window.addEventListener("resize",l,{passive:!0}),()=>{window.removeEventListener("scroll",l),window.removeEventListener("resize",l)}},[s]),a?_("div",{class:`pa-marker ${n?"active":""}`,style:{left:`${a.left}px`,top:`${a.top}px`},onClick:r,title:e.title,children:t+1}):null};function nt(e,t){const[n,r]=C([]),[a,o]=C(!0),[s,l]=C(null),[u,c]=C(()=>window.location.origin+window.location.pathname);M(()=>{const d=()=>window.location.origin+window.location.pathname,f=()=>{const b=d();b!==u&&c(b)};window.addEventListener("popstate",f),window.addEventListener("hashchange",f);const g=history.pushState.bind(history),v=history.replaceState.bind(history);return history.pushState=function(...b){g(...b),f()},history.replaceState=function(...b){v(...b),f()},()=>{window.removeEventListener("popstate",f),window.removeEventListener("hashchange",f),history.pushState=g,history.replaceState=v}},[u]);const h=T(async()=>{o(!0),l(null);try{const f=await(await fetch(`${e}/annotations/by-url?url=${encodeURIComponent(u)}`)).json();f.success?r(f.data):l(f.error||"Failed to fetch annotations")}catch(d){l(String(d))}finally{o(!1)}},[e,u]);M(()=>{h()},[h]);const i=T(async d=>{try{const g=await(await fetch(`${e}/annotations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...d,actor:d.actor||t})})).json();return g.success?(r(v=>[g.data,...v]),g.data):(l(g.error||"Failed to create annotation"),null)}catch(f){return l(String(f)),null}},[e,t]),m=T(async(d,f)=>{try{const v=await(await fetch(`${e}/annotations/${d}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({...f,actor:f.actor||t})})).json();return v.success?(r(b=>b.map(S=>S.id===d?v.data:S)),v.data):(l(v.error||"Failed to update annotation"),null)}catch(g){return l(String(g)),null}},[e,t]),p=T(async d=>{try{const g=await(await fetch(`${e}/annotations/${d}?actor=${encodeURIComponent(t)}`,{method:"DELETE"})).json();return g.success?(r(v=>v.filter(b=>b.id!==d)),!0):(l(g.error||"Failed to delete annotation"),!1)}catch(f){return l(String(f)),!1}},[e,t]);return{annotations:n,loading:a,error:s,refresh:h,create:i,update:m,remove:p,currentUrl:u}}function ot(e){if(e.id)return`#${e.id}`;const t=[];let n=e;for(;n&&n!==document.body;){let r=n.tagName.toLowerCase();if(n.className&&typeof n.className=="string"){const o=n.className.split(" ").filter(s=>s.trim()&&!s.startsWith("pa-")).slice(0,2);o.length>0&&(r+="."+o.join("."))}const a=n.parentElement?.children;if(a&&a.length>1){const o=Array.from(a).indexOf(n);o>0&&(r+=`:nth-child(${o+1})`)}t.unshift(r),n=n.parentElement}return t.join(" > ")}function rt(e){const t=[];let n=e;for(;n&&n.nodeType===Node.ELEMENT_NODE;){let r=0,a=n.previousSibling;for(;a;)a.nodeType===Node.ELEMENT_NODE&&a.tagName===n.tagName&&r++,a=a.previousSibling;const o=n.tagName.toLowerCase(),s=r>0?`${o}[${r+1}]`:o;t.unshift(s),n=n.parentElement}return"/"+t.join("/")}function ae(e){return e.composedPath().some(n=>n instanceof HTMLElement?n.id==="prototype-annotator-root"||n.id==="prototype-annotator-container":!1)}function it(){const[e,t]=C("none"),[n,r]=C(null),[a,o]=C(null),[s,l]=C(null),[u,c]=C(null),h=T(()=>{r(null),o(null),l(null),c(null)},[]);return M(()=>{if(e!=="element"){o(null),l(null);return}const i=p=>{if(ae(p)){o(null),l(null);return}const d=p.target;o(d),l(d.getBoundingClientRect())},m=p=>{if(ae(p))return;p.preventDefault(),p.stopPropagation();const d=p.target,f=d.getBoundingClientRect();r({type:"element",selector:ot(d),xpath:rt(d),textContent:d.textContent?.slice(0,100)||"",rect:f}),t("none")};return document.addEventListener("mousemove",i),document.addEventListener("click",m,!0),()=>{document.removeEventListener("mousemove",i),document.removeEventListener("click",m,!0)}},[e]),M(()=>{if(e!=="rect"){c(null);return}const i=d=>{ae(d)||(d.preventDefault(),c({startX:d.clientX,startY:d.clientY,endX:d.clientX,endY:d.clientY}))},m=d=>{c(f=>f?{...f,endX:d.clientX,endY:d.clientY}:null)},p=d=>{c(f=>{if(!f)return null;const g=Math.min(f.startX,d.clientX),v=Math.min(f.startY,d.clientY),b=Math.abs(d.clientX-f.startX),S=Math.abs(d.clientY-f.startY);return b>10&&S>10&&r({type:"rect",x:g,y:v,width:b,height:S,scrollX:window.scrollX,scrollY:window.scrollY,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight}),t("none"),null})};return document.addEventListener("mousedown",i),document.addEventListener("mousemove",m),document.addEventListener("mouseup",p),()=>{document.removeEventListener("mousedown",i),document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",p)}},[e]),M(()=>{const i=m=>{m.key==="Escape"&&e!=="none"&&(t("none"),h())};return document.addEventListener("keydown",i),()=>document.removeEventListener("keydown",i)},[e,h]),{mode:e,setMode:t,selection:n,clearSelection:h,hoveredElement:a,hoveredRect:s,rectDrag:u}}const at=({config:e})=>{const[t,n]=C(!1),[r,a]=C(null),{annotations:o,loading:s,create:l,update:u,remove:c,currentUrl:h,refresh:i}=nt(e.apiUrl,e.defaultActor),{mode:m,setMode:p,selection:d,clearSelection:f,hoveredRect:g,rectDrag:v}=it();M(()=>{d&&n(!0)},[d]),M(()=>{f(),a(null)},[h,f]),M(()=>(window.__PROTOTYPE_ANNOTATOR__={refresh:i},()=>{delete window.__PROTOTYPE_ANNOTATOR__}),[i]),M(()=>{const x=$=>{if(!$.composedPath().some(N=>N instanceof HTMLInputElement||N instanceof HTMLTextAreaElement))switch($.key.toLowerCase()){case"e":p(m==="element"?"none":"element");break;case"r":p(m==="rect"?"none":"rect");break;case"s":n(N=>!N);break}};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[m,p]);const b=T(x=>{p(x),f(),a(null)},[p,f]),S=T(async x=>{if(!d)return;const $={url_full:window.location.href,title:x.title,body:x.body,anchor_type:d.type,anchor_payload:d.type==="element"?{selector:d.selector,xpath:d.xpath,textContent:d.textContent}:{x:d.x,y:d.y,width:d.width,height:d.height,scrollX:d.scrollX,scrollY:d.scrollY,viewportWidth:d.viewportWidth,viewportHeight:d.viewportHeight}};await l($),f()},[d,l,f]),w=T(async(x,$)=>{await u(x,$)},[u]),O=T(async x=>{await c(x)},[c]),z=T(()=>{f()},[f]),R=T(x=>{a(x),x&&n(!0)},[]);return _(P,{children:[_(et,{mode:m,hoveredRect:g,rectDrag:v}),o.map((x,$)=>_(tt,{annotation:x,index:$,isActive:r?.id===x.id,onClick:()=>R(x)},x.id)),_(Ze,{open:t,onClose:()=>n(!1),annotations:o,loading:s,selection:d,selectedAnnotation:r,onSelectAnnotation:R,onCreateAnnotation:S,onUpdateAnnotation:w,onDeleteAnnotation:O,onCancelSelection:z,basePath:e.basePath}),_(Ke,{sidebarOpen:t,onToggleSidebar:()=>n(x=>!x),selectionMode:m,onSetSelectionMode:b})]})},lt=":host{all:initial;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,sans-serif;font-size:14px;line-height:1.5;color:#1a1a1a}*{box-sizing:border-box}.pa-toolbar{position:fixed;bottom:20px;right:20px;display:flex;gap:8px;z-index:999999}.pa-toolbar-btn{width:48px;height:48px;border-radius:50%;border:none;background:#2563eb;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px #00000026;transition:transform .15s,background .15s}.pa-toolbar-btn:hover{transform:scale(1.05);background:#1d4ed8}.pa-toolbar-btn.active{background:#dc2626}.pa-toolbar-btn svg{width:24px;height:24px}.pa-sidebar{position:fixed;top:0;left:0;width:360px;height:100vh;background:#fff;box-shadow:4px 0 20px #0000001a;z-index:999998;transform:translate(-100%);transition:transform .3s ease;display:flex;flex-direction:column}.pa-sidebar.open{transform:translate(0)}.pa-sidebar-header{padding:16px 20px;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;justify-content:space-between}.pa-sidebar-title{font-size:16px;font-weight:600;margin:0}.pa-close-btn{background:none;border:none;cursor:pointer;padding:4px;border-radius:4px;color:#6b7280}.pa-close-btn:hover{background:#f3f4f6;color:#1a1a1a}.pa-sidebar-content{flex:1;overflow-y:auto;padding:16px 20px}.pa-sidebar-footer{padding:16px 20px;border-top:1px solid #e5e7eb}.pa-annotation-list{display:flex;flex-direction:column;gap:12px}.pa-annotation-item{padding:12px;background:#f9fafb;border-radius:8px;border:1px solid #e5e7eb;cursor:pointer;transition:border-color .15s}.pa-annotation-item:hover{border-color:#2563eb}.pa-annotation-item-title{font-weight:500;margin-bottom:4px}.pa-annotation-item-body{font-size:13px;color:#6b7280;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.pa-annotation-item-meta{font-size:11px;color:#9ca3af;margin-top:8px}.pa-empty-state{text-align:center;padding:32px 16px;color:#6b7280}.pa-form{display:flex;flex-direction:column;gap:16px}.pa-form-group{display:flex;flex-direction:column;gap:4px}.pa-form-label{font-size:13px;font-weight:500;color:#374151}.pa-form-input{padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:14px;outline:none;transition:border-color .15s}.pa-form-input:focus{border-color:#2563eb}.pa-form-textarea{min-height:100px;resize:vertical}.pa-form-actions{display:flex;gap:8px;justify-content:flex-end}.pa-btn{padding:8px 16px;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;transition:background .15s}.pa-btn-primary{background:#2563eb;color:#fff;border:none}.pa-btn-primary:hover{background:#1d4ed8}.pa-btn-secondary{background:#fff;color:#374151;border:1px solid #d1d5db}.pa-btn-secondary:hover{background:#f9fafb}.pa-btn-danger{background:#dc2626;color:#fff;border:none}.pa-btn-danger:hover{background:#b91c1c}.pa-selection-overlay{position:fixed;inset:0;z-index:999997;cursor:crosshair}.pa-selection-rect{position:fixed;border:2px dashed #2563eb;background:#2563eb1a;pointer-events:none;z-index:999997}.pa-element-highlight{position:fixed;border:2px solid #2563eb;background:#2563eb1a;pointer-events:none;z-index:999997}.pa-marker{position:fixed;width:24px;height:24px;background:#2563eb;border-radius:50%;color:#fff;font-size:12px;font-weight:600;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:999996;box-shadow:0 2px 8px #0003;transition:transform .15s}.pa-marker:hover{transform:scale(1.1)}.pa-marker.active{background:#dc2626}.pa-mode-indicator{position:fixed;top:20px;left:50%;transform:translate(-50%);padding:8px 16px;background:#1a1a1a;color:#fff;border-radius:20px;font-size:13px;z-index:999999;display:flex;align-items:center;gap:8px}.pa-mode-indicator kbd{background:#fff3;padding:2px 6px;border-radius:4px;font-size:11px}.pa-tabs{display:flex;border-bottom:1px solid #e5e7eb;margin-bottom:16px}.pa-tab{padding:8px 16px;background:none;border:none;cursor:pointer;font-size:14px;color:#6b7280;border-bottom:2px solid transparent;margin-bottom:-1px}.pa-tab.active{color:#2563eb;border-bottom-color:#2563eb}.pa-tab:hover:not(.active){color:#374151}";function Pe(){const e=window.__PROTOTYPE_ANNOTATOR_CONFIG__;if(!e){console.error("[prototype-annotator] No configuration found");return}if(document.getElementById("prototype-annotator-root"))return;const t=document.createElement("div");t.id="prototype-annotator-root",document.body.appendChild(t);const n=t.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=lt,n.appendChild(r);const a=document.createElement("div");a.id="prototype-annotator-container",n.appendChild(a),Re(_(at,{config:e}),a),console.log("[prototype-annotator] Overlay mounted")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Pe):Pe()})();
//# sourceMappingURL=overlay.js.map
